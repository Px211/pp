<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <title>打地鼠小遊戲</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", sans-serif;
      background: #f2f2f2;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    h1 {
      margin-top: 20px;
    }
    .game-info {
      margin: 10px;
      font-size: 18px;
    }
    .grid {
      width: 450px;
      height: 450px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      margin: 20px auto;
      gap: 5px;
    }
    .hole {
      width: 140px;
      height: 140px;
      background: #555;
      border-radius: 10px;
      position: relative;
      cursor: pointer;
    }
    .mole {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      position: absolute;
      top: 20px;
      left: 20px;
      display: none;
    }
    .gray { background: gray; }
    .blue { background: dodgerblue; }
    .rainbow {
      background: linear-gradient(45deg, red, orange, yellow, green, blue, indigo, violet);
    }
    .menu, .pause-menu {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      color: white;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 100;
    }
    .menu button, .pause-menu button {
      padding: 10px 20px;
      margin: 10px;
      font-size: 18px;
      cursor: pointer;
    }
    .btn {
      margin: 10px;
      padding: 8px 15px;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <h1>🎯 打地鼠小遊戲</h1>
  <div class="game-info">
    分數: <span id="score">0</span> ｜ 時間: <span id="time">30</span>s ｜ 關卡: <span id="level">1</span>
  </div>
  <button class="btn" id="pauseBtn">⏸ 暫停</button>
  <div class="grid" id="grid"></div>

  <!-- 主畫面 -->
  <div class="menu" id="mainMenu" style="display:flex;">
    <h1>打地鼠小遊戲</h1>
    <button onclick="startGame()">開始遊戲</button>
  </div>

  <!-- 暫停選單 -->
  <div class="pause-menu" id="pauseMenu">
    <h2>暫停中</h2>
    <button onclick="resumeGame()">繼續</button>
    <button onclick="backToMenu()">回主畫面</button>
  </div>

  <script>
    const grid = document.getElementById("grid");
    const scoreEl = document.getElementById("score");
    const timeEl = document.getElementById("time");
    const levelEl = document.getElementById("level");
    const pauseBtn = document.getElementById("pauseBtn");
    const mainMenu = document.getElementById("mainMenu");
    const pauseMenu = document.getElementById("pauseMenu");

    let score = 0;
    let time = 30;
    let level = 1;
    let timer;
    let moleTimer;
    let gameRunning = false;
    let paused = false;

    const levelTarget = {1: 50, 2: 100}; // 關卡分數門檻
    const moleTypes = [
      {class:"gray", points:3, weight:6},
      {class:"blue", points:6, weight:3},
      {class:"rainbow", points:8, weight:1}
    ];

    // 建立九宮格
    for (let i = 0; i < 9; i++) {
      const hole = document.createElement("div");
      hole.classList.add("hole");
      const mole = document.createElement("div");
      mole.classList.add("mole");
      hole.appendChild(mole);
      grid.appendChild(hole);

      hole.addEventListener("click", () => {
        if (mole.style.display === "block") {
          score += mole.dataset.points * 1;
          scoreEl.textContent = score;
          mole.style.display = "none";
        }
      });
    }

    function startGame() {
      mainMenu.style.display = "none";
      resetGame();
      gameRunning = true;
      runLevel();
    }

    function resetGame() {
      score = 0;
      level = 1;
      scoreEl.textContent = 0;
      levelEl.textContent = 1;
    }

    function runLevel() {
      time = 30;
      timeEl.textContent = time;
      timer = setInterval(() => {
        if (!paused) {
          time--;
          timeEl.textContent = time;
          if (time <= 0) endLevel();
        }
      }, 1000);
      moleTimer = setInterval(spawnMole, 800);
    }

    function spawnMole() {
      const holes = document.querySelectorAll(".hole");
      const hole = holes[Math.floor(Math.random() * holes.length)];
      const mole = hole.querySelector(".mole");

      if (mole.style.display === "block") return;

      const type = weightedRandom(moleTypes);
      mole.className = "mole " + type.class;
      mole.dataset.points = type.points;
      mole.style.display = "block";

      setTimeout(() => {
        mole.style.display = "none";
      }, 700);
    }

    function weightedRandom(types) {
      let total = types.reduce((sum,t)=>sum+t.weight,0);
      let r = Math.random() * total;
      for (let t of types) {
        if (r < t.weight) return t;
        r -= t.weight;
      }
    }

    function endLevel() {
      clearInterval(timer);
      clearInterval(moleTimer);
      if (level <= 2) {
        if (score >= levelTarget[level]) {
          level++;
          levelEl.textContent = level;
          runLevel();
        } else {
          alert("挑戰失敗！分數不足！");
          backToMenu();
        }
      } else {
        alert("遊戲結束！你的最終分數是 " + score);
        backToMenu();
      }
    }

    pauseBtn.addEventListener("click", () => {
      if (gameRunning) {
        paused = true;
        pauseMenu.style.display = "flex";
      }
    });

    function resumeGame() {
      paused = false;
      pauseMenu.style.display = "none";
    }

    function backToMenu() {
      clearInterval(timer);
      clearInterval(moleTimer);
      gameRunning = false;
      paused = false;
      pauseMenu.style.display = "none";
      mainMenu.style.display = "flex";
      scoreEl.textContent = 0;
      timeEl.textContent = 30;
      levelEl.textContent = 1;
    }
  </script>
</body>
</html>
